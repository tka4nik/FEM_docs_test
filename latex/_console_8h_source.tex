\hypertarget{_console_8h_source}{}\doxysection{Console.\+h}
\label{_console_8h_source}\index{C:/Projects/FEM/831\_finite\_element\_modeling/GUI/source/GUI/Console.h@{C:/Projects/FEM/831\_finite\_element\_modeling/GUI/source/GUI/Console.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <queue>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <condition\_variable>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <functional>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <Windows.h>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{char} EndL = \textcolor{charliteral}{'\(\backslash\)n'};}
\DoxyCodeLine{14 \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} OtherTag = -\/1;}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#define SIGNATURE\_COLOR FOREGROUND\_BLUE | FOREGROUND\_GREEN | FOREGROUND\_INTENSITY}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#define HEAD\_COLOR FOREGROUND\_BLUE | FOREGROUND\_GREEN | FOREGROUND\_RED | FOREGROUND\_INTENSITY}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define DETAILS\_COLOR FOREGROUND\_GREEN | FOREGROUND\_RED }}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#define DEFAULT\_COLOR FOREGROUND\_BLUE | FOREGROUND\_GREEN | FOREGROUND\_RED }}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define ERROR\_COLOR FOREGROUND\_RED}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#define WARNING\_COLOR FOREGROUND\_GREEN | FOREGROUND\_RED}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#define TAG\_COLOR FOREGROUND\_GREEN | FOREGROUND\_INTENSITY}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define OUTPUT 0x001}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define MSGLOG 0x01}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{class }\mbox{\hyperlink{class_console}{Console}} \{}
\DoxyCodeLine{28     }
\DoxyCodeLine{29 \textcolor{keyword}{public}:}
\DoxyCodeLine{30     \textcolor{keyword}{class }\mbox{\hyperlink{class_console_1_1_command}{Command}};}
\DoxyCodeLine{31     \textcolor{keyword}{enum class} CommandType \{}
\DoxyCodeLine{32         immediate,}
\DoxyCodeLine{33         deferred}
\DoxyCodeLine{34     \};}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \mbox{\hyperlink{class_console}{Console}}(\textcolor{keyword}{const} \mbox{\hyperlink{class_console}{Console}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{37     \mbox{\hyperlink{class_console}{Console}}() = \textcolor{keyword}{delete};}
\DoxyCodeLine{38     \mbox{\hyperlink{class_console}{Console}}\& operator=(\textcolor{keyword}{const} \mbox{\hyperlink{class_console}{Console}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{39 }
\DoxyCodeLine{40 }
\DoxyCodeLine{50     \textcolor{keyword}{static} \mbox{\hyperlink{class_console}{Console}}* \mbox{\hyperlink{class_console_a280bd39249c6b807c443d0c8d1dcea0f}{Instance}}(std::istream\& input\_stream, std::ostream\& output\_log, std::ostream\& message\_log);}
\DoxyCodeLine{54     \textcolor{keyword}{static} \mbox{\hyperlink{class_console}{Console}}* \mbox{\hyperlink{class_console_a280bd39249c6b807c443d0c8d1dcea0f}{Instance}}();}
\DoxyCodeLine{55 }
\DoxyCodeLine{61     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_aa888891efac952b86c20d33fc860e028}{AddCommand}}(std::string console\_name, \mbox{\hyperlink{class_console_1_1_command}{Command}} command);}
\DoxyCodeLine{62 }
\DoxyCodeLine{73     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_a28789050eae23a13a2652f2660808934}{AddTag}}(\textcolor{keywordtype}{int} \textcolor{keywordtype}{id}, std::string description);}
\DoxyCodeLine{74 }
\DoxyCodeLine{79     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_a0de96c1775644145cc9e88a038b5b439}{Input}}();}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 }
\DoxyCodeLine{90     \textcolor{keyword}{template}<\textcolor{keyword}{typename}...Args>}
\DoxyCodeLine{91     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_a475fa2f09bcde87346d13c2828d9ce0e}{WriteInLogs}}(Args\&\&...args) \{}
\DoxyCodeLine{92         (void)(m\_output\_log << ... << args);}
\DoxyCodeLine{93         (void)(m\_message\_log << ... << args);}
\DoxyCodeLine{94     \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96 }
\DoxyCodeLine{100     \textcolor{keyword}{template}<\textcolor{keyword}{typename}...Args>}
\DoxyCodeLine{101     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_ab04e72ca62ca9f6ed2047baffa406ab6}{WriteInOutput}}(Args\&\&...args) \{}
\DoxyCodeLine{102         (void)(m\_output\_log << ... << args);}
\DoxyCodeLine{103     \}}
\DoxyCodeLine{104 }
\DoxyCodeLine{108     \textcolor{keyword}{template}<\textcolor{keyword}{typename}...Args>}
\DoxyCodeLine{109     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_ad614052ed6053f8b395a0cab9fe81aea}{WriteInMessageLog}}(Args\&\&...args) \{}
\DoxyCodeLine{110         (void)(m\_message\_log << ... << args);}
\DoxyCodeLine{111     \}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 }
\DoxyCodeLine{124     \textcolor{keyword}{template}<\textcolor{keyword}{typename}...Args>}
\DoxyCodeLine{125     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_a1cdfcdd54933908d065118f39e4a39db}{ReportError}}(\textcolor{keywordtype}{int} log, Args\&\&...args) \{}
\DoxyCodeLine{126         SetConsoleTextAttribute(m\_hConsole, ERROR\_COLOR);}
\DoxyCodeLine{127         \textcolor{keywordflow}{if} (log \& MSGLOG)}
\DoxyCodeLine{128             (void)(m\_message\_log << ... << args);}
\DoxyCodeLine{129         \textcolor{keywordflow}{if} (log \& OUTPUT)}
\DoxyCodeLine{130             (void)(m\_output\_log << ... << args);}
\DoxyCodeLine{131         SetConsoleTextAttribute(m\_hConsole, DEFAULT\_COLOR);}
\DoxyCodeLine{132     \}}
\DoxyCodeLine{133 }
\DoxyCodeLine{144     \textcolor{keyword}{template}<\textcolor{keyword}{typename}...Args>}
\DoxyCodeLine{145     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_a2fc48b33669993ad4da7a2fafc6b7699}{ReportWarning}}(\textcolor{keywordtype}{int} log, Args\&\&...args) \{}
\DoxyCodeLine{146         SetConsoleTextAttribute(m\_hConsole, WARNING\_COLOR);}
\DoxyCodeLine{147         \textcolor{keywordflow}{if} (log \& MSGLOG)}
\DoxyCodeLine{148             (void)(m\_message\_log << ... << args);}
\DoxyCodeLine{149         \textcolor{keywordflow}{if} (log \& OUTPUT)}
\DoxyCodeLine{150             (void)(m\_output\_log << ... << args);}
\DoxyCodeLine{151         SetConsoleTextAttribute(m\_hConsole, WARNING\_COLOR);}
\DoxyCodeLine{152     \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154 }
\DoxyCodeLine{155     \textcolor{keyword}{enum class} DlgAnswer \{}
\DoxyCodeLine{156         Yes,}
\DoxyCodeLine{157         No,}
\DoxyCodeLine{158         Undefined}
\DoxyCodeLine{159     \};}
\DoxyCodeLine{160 }
\DoxyCodeLine{171     DlgAnswer \mbox{\hyperlink{class_console_aa7891703d22bdc9106709549f4fba86a}{DlgQuestion}}(\textcolor{keyword}{const} std::string\& question, \textcolor{keyword}{const} std::string\& answ\_yes, \textcolor{keyword}{const} std::string\& answ\_no, \textcolor{keywordtype}{bool} loop = \textcolor{keyword}{false});}
\DoxyCodeLine{172 }
\DoxyCodeLine{182     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_a82f3c863a83ba0b844cb2f8e15ab7449}{Help}}(\textcolor{keyword}{const} std::vector<std::string>\& args);}
\DoxyCodeLine{183 }
\DoxyCodeLine{184     \textcolor{comment}{/*}}
\DoxyCodeLine{185 \textcolor{comment}{    *@brief Устанавливает callback, который будет вызван, если была введена команда exit.}}
\DoxyCodeLine{186 \textcolor{comment}{    * @details В этой реализации callback высталяет m\_stop = true, чтобы завершить моделирование. см. GUI::GUI(int\& argc, char** argv).}}
\DoxyCodeLine{187 \textcolor{comment}{    */}}
\DoxyCodeLine{188     \textcolor{keywordtype}{void} SetExitCallBack(\textcolor{keyword}{const} std::function<\textcolor{keywordtype}{void}()>\& callback);}
\DoxyCodeLine{189 }
\DoxyCodeLine{190     \textcolor{comment}{/*}}
\DoxyCodeLine{191 \textcolor{comment}{    Возвращаяет id потока очереди}}
\DoxyCodeLine{192 \textcolor{comment}{    */}}
\DoxyCodeLine{193     std::thread::id GetQueueID();}
\DoxyCodeLine{194 }
\DoxyCodeLine{195     \mbox{\hyperlink{class_console}{\string~Console}}();}
\DoxyCodeLine{196 \textcolor{keyword}{private}:}
\DoxyCodeLine{197     \mbox{\hyperlink{class_console}{Console}}(std::istream\& input\_stream, std::ostream\& output\_log, std::ostream\& message\_log);}
\DoxyCodeLine{198 }
\DoxyCodeLine{199 }
\DoxyCodeLine{205     \textcolor{keywordtype}{void} Execute(Command\&, std::vector<std::string>\&\& args);}
\DoxyCodeLine{206 }
\DoxyCodeLine{210     \textcolor{keywordtype}{void} DequeExecute();}
\DoxyCodeLine{211 }
\DoxyCodeLine{212 }
\DoxyCodeLine{213 }
\DoxyCodeLine{214     \textcolor{comment}{//void ArgumentCheck();}}
\DoxyCodeLine{215 }
\DoxyCodeLine{219     \textcolor{keywordtype}{void} Exit();}
\DoxyCodeLine{220 }
\DoxyCodeLine{226     \textcolor{keywordtype}{bool} ExitArgumentCheck(\textcolor{keyword}{const} std::vector<std::string>\& args);}
\DoxyCodeLine{227 }
\DoxyCodeLine{233     \textcolor{keywordtype}{bool} HelpArgumentCheck(\textcolor{keyword}{const} std::vector<std::string>\& args);}
\DoxyCodeLine{234 }
\DoxyCodeLine{240     \textcolor{keywordtype}{bool} IsAvailableTag(\textcolor{keywordtype}{int} tag);}
\DoxyCodeLine{241 }
\DoxyCodeLine{242 }
\DoxyCodeLine{243     \textcolor{keyword}{static} \mbox{\hyperlink{class_console}{Console}}* s\_instance;           \textcolor{comment}{//экземпляр синглтона}}
\DoxyCodeLine{244     \textcolor{keyword}{static} std::once\_flag s\_instance\_flag; \textcolor{comment}{//флаг создания синглтона. нужен для std::call\_once}}
\DoxyCodeLine{245 }
\DoxyCodeLine{246     std::istream\& m\_input\_stream; \textcolor{comment}{//пользовательский поток ввода}}
\DoxyCodeLine{247     std::ostream\& m\_output\_log;   \textcolor{comment}{//пользовательский поток вывода}}
\DoxyCodeLine{248 }
\DoxyCodeLine{249     std::ostream\& m\_message\_log;  \textcolor{comment}{//журнал сообщений, предупреждений, ошибок.}}
\DoxyCodeLine{250 }
\DoxyCodeLine{251 }
\DoxyCodeLine{252     std::thread m\_execution\_thread; \textcolor{comment}{//поток, который выполняет команды из очереди}}
\DoxyCodeLine{253     std::queue<std::pair<Command\&, std::vector<std::string>>> m\_queue; \textcolor{comment}{//та самая очередь с командами для m\_execution\_thread}}
\DoxyCodeLine{254     std::mutex m\_queue\_mutex; \textcolor{comment}{//этот мьютех используется для защиты очереди от изменения двумя потоками (m\_execution\_thread, Input()) одновременно }}
\DoxyCodeLine{255     std::condition\_variable m\_execution\_interruptor; \textcolor{comment}{//для того же, для чего и m\_queue\_mutex}}
\DoxyCodeLine{256 }
\DoxyCodeLine{257 }
\DoxyCodeLine{258     std::map<std::string, Command> m\_commands; \textcolor{comment}{// Все зарегистрированные команды. }}
\DoxyCodeLine{259     \textcolor{comment}{//Смысл элементов -\/ \{<строка:имя команды для пользователя>, <объект Command c ссылками на саму функцию и функцию проверки аргументов>\}}}
\DoxyCodeLine{260     std::map<size\_t, std::string> m\_tags; \textcolor{comment}{//Все добавленные теги, кроме OtherTag(тег по умолчанию) -\/ смысл элементов -\/ \{id, description\}}}
\DoxyCodeLine{261     std::string m\_other\_tag\_description; \textcolor{comment}{// описание тега OtherTag = -\/1.}}
\DoxyCodeLine{262 }
\DoxyCodeLine{263     std::function<void()> m\_exit\_callback; \textcolor{comment}{//callback, срабатывает при вызове Exit.}}
\DoxyCodeLine{264 }
\DoxyCodeLine{265     \textcolor{keywordtype}{bool} m\_dlg\_require = \textcolor{keyword}{false}; \textcolor{comment}{//нужно ли направить входные данные в диалог DlgQuestion или распарсить их как команду.}}
\DoxyCodeLine{266     std::condition\_variable m\_dlg\_interruptor; \textcolor{comment}{//Для синхронизации потока, в котором выполняется DlgQuestion и Input}}
\DoxyCodeLine{267     std::string m\_dlg\_input; \textcolor{comment}{//данные которые направляются в диалог.}}
\DoxyCodeLine{268 }
\DoxyCodeLine{269     \textcolor{keywordtype}{bool} m\_exit;}
\DoxyCodeLine{270 }
\DoxyCodeLine{271     HANDLE m\_hConsole; \textcolor{comment}{//Для цветов в консоли}}
\DoxyCodeLine{272 }
\DoxyCodeLine{273     }
\DoxyCodeLine{274 \};}
\DoxyCodeLine{275 }
\DoxyCodeLine{276 }
\DoxyCodeLine{277 }
\DoxyCodeLine{278 }
\DoxyCodeLine{282 \textcolor{keyword}{class }\mbox{\hyperlink{class_console_1_1_command}{Console::Command}} \{}
\DoxyCodeLine{283 \textcolor{keyword}{public}:}
\DoxyCodeLine{284     \textcolor{keyword}{friend} \textcolor{keyword}{class }\mbox{\hyperlink{class_console}{Console}};}
\DoxyCodeLine{285 }
\DoxyCodeLine{291     \mbox{\hyperlink{class_console_1_1_command}{Command}}(\textcolor{keyword}{const} std::function<\textcolor{keywordtype}{void}(std::vector<std::string>\&)>\& func,\textcolor{keyword}{const} std::function<\textcolor{keywordtype}{bool}(std::vector<std::string>\&)>\& argument\_check);}
\DoxyCodeLine{292     }
\DoxyCodeLine{293     \textcolor{comment}{/*}}
\DoxyCodeLine{294 \textcolor{comment}{    @brief Устанавливает id тега для этой команды}}
\DoxyCodeLine{295 \textcolor{comment}{    @param tag -\/ it тега}}
\DoxyCodeLine{296 \textcolor{comment}{    */}}
\DoxyCodeLine{297     \textcolor{keywordtype}{bool} SetTag(\textcolor{keywordtype}{int} tag);}
\DoxyCodeLine{303     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_1_1_command_a8ba5274617e52ed1fa17794c0c0f5c51}{SetDescription}}(std::string brief\_description, std::string detailed\_description);}
\DoxyCodeLine{304 }
\DoxyCodeLine{316     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_console_1_1_command_a1dfb06b1cd421a19b6627cca01077f78}{SetExecutionType}}(CommandType type);}
\DoxyCodeLine{317 }
\DoxyCodeLine{318 \textcolor{keyword}{private}:}
\DoxyCodeLine{319     std::function<void(std::vector<std::string>\&)> m\_func;}
\DoxyCodeLine{320     std::function<bool(std::vector<std::string>\&)> m\_argument\_check;}
\DoxyCodeLine{321     \textcolor{keywordtype}{int} m\_tag = 0;}
\DoxyCodeLine{322     CommandType m\_type = CommandType::immediate;}
\DoxyCodeLine{323     std::string m\_brief\_description;}
\DoxyCodeLine{324     std::string m\_detailed\_description;}
\DoxyCodeLine{325 \};}

\end{DoxyCode}
